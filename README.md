# React In Action

《React实战》ch03

```bash
npm install -g browser-sync

# 实时更新页面
browser-sync start --server --browser "Google Chrome" --files "stylesheets/*.css, *.html, *.js"

```

## 问题

* 当谈及“状态”时，我们究竟讨论的是什么？
* 如何描述应用在某个时刻的状态？
* 为什么这是一个问题而且为什么那样做行不通呢？

## 概念

* 什么是状态

状态：程序在特定瞬间可访问的所有信息。

仅通过读取你就可以检索给定时刻的状态，但当你随着时间的推移而进行了某些修改，程序的状态就会变化。

* 减少或屏蔽一些现代UI的极度复杂的状态

一种方法是提供两个处理数据的特定API：属性（props）和状态（state）。

*可变的

一个可变的临时数据结构，随着时间的推移只支持一个版本；可变的数据结构在其变化时可以被覆盖并且不支持其他版本。

* 不可变的

一个不可变的持久数据结构，随着时间的推移可以支持多个版本，但不能直接覆盖；不可变数据结构通常是持久的。

![可变vs不可变的数据结构](https://tva1.sinaimg.cn/large/007S8ZIlly1ggomjgjre1j30hs08q0ug.jpg)

不可变或持久的数据结构常常记录一段历史并且不会改变，但会对随着时间的推移发生的变化进行版本化。但是，临时数据结构通常不记录历史并且随着每次更新都会被抛弃

* 另一种考虑不可变数据结构和可变的数据结构之间的区别的方法是考虑这两种数据结构各自拥有的不同能力和内存。

![处理可变数据和不可变数据的变化](https://tva1.sinaimg.cn/large/007S8ZIlly1ggomrp074wj30hs0cidi2.jpg)

临时数据结构没有版本，所以当更改它们时，所有以前的状态都消失了。它们可以说是`活在当下`，而不可变数据结构能够随时间的推移而持续存在

**提示** 考虑不可变性与可变性的另一种方法是考虑“保存”和“另存为”之间的区别。

React用可变的方式暴露组件的状态（通过`setState`进行改变）并将属性作为只读的。

* this.state

this引用的是类的实例，而state则是一个React会进行追踪的特殊属性。

* setState API

setState接收一个用来设置组件新状态的函数以及一个可选的回调函数。

```jsx
setState(
  updater,    // (prevState, props) => stateChange
  [callback]
) -> void
```

React的全面声明性异步范式：容许系统（React）`安排更新`，保证顺序但不保证时间。

setState会使用updater函数返回的对象与当前状态进行浅合并。

* defaultProps

组件自身的defaultProps静态方法

属性可以随时间改变，但不是从组建内部改变。

一个使用状态的父组件（继承自React.Component）可以改变自己的状态，这个改变的状态可以作为属性传递给子组件，从而改变属性。

```jsx
// 属性类型检查
static propTypes = {
  incrementBy: PropTypes.number,
  onIncrement: PropTypes.func.isRequired
};

// 默认属性
static defaultProps = {
  incrementBy: 1
};
```

* 组件间的is-a和has-a关系

* 组件间通信

访问父组件中的数据（要么是状态要么是属性）；

传递数据给子组件；

* 数据绑定

![数据绑定](https://tva1.sinaimg.cn/large/007S8ZIlly1ggpd8yl7e9j30hs09l77b.jpg)

数据绑定通常指的是在应用数据与视图（该数据的展示）之间建立连接的过程。

React中一个更有帮助的思考方法是将其作为**投影**：UI是投射到视图中的数据，当数据变化时，视图随之变化

* 单向数据流

数据流是另一种思考数据绑定的方法

什么能够更新什么，从哪里更新，以及如何更新？

可以通过回调函数将数据传回层次结构的上层。

![单向数据流](https://tva1.sinaimg.cn/large/007S8ZIlly1ggpdh1ap8mj308w0710tj.jpg)

数据在React中是按一个方向流动的。

* 主题

```html
状态是程序在特定瞬间可访问的信息。
不可变状态不会改变，而可变状态会改变。
持久的、不可变的数据结构不会改变——它们只记录其改变并创建自己的副本。
临时的、可变的数据结构会在更新时被清除。
React即使用可变数据（组件本地状态），也使用伪不可变数据（属性）。
属性是伪不可变的并且一旦设置就不应该被修改。
组件状态由支撑实例追踪并且可以使用setState进行修改。
setState执行数据的浅合并、更新组件状态，保留任何没有被覆盖的顶级属性。
React中的数据流是单向的，从父组件流向子组件。子组件通过回调函数将数据回送给父组件，但它们不能直接修改父组件的状态，而且父组件也无法直接修改子组件的状态。
组件通过属性完成组件交互。
```
